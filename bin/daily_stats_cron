#!/bin/bash

echo started at `date`

if [[ ! -d $STATS_DIR ]]; then
	echo "STATS_DIR='$STATS_DIR' is not a directory"
	exit 1
fi

function git_check {
	if [[ -z $(git status --porcelain) ]];
	then
		echo "git is clean, proceeding...."
		echo ""
	else
		echo "PLEASE COMMIT YOUR CHANGE FIRST!!!"
		git status --porcelain
		exit 1
	fi
}

# clean start
cd $STATS_DIR
git_check
echo "git pull"
git pull
git_check

# run jobs
cd $STATS_DIR/../bin
./get_dnet
./get_steam
./get_ebay

echo -e "\ncharts:"
./chart_ebay
./chart_rc5
./chart_steam

# commit
echo ""
git add ../data
git commit -m 'daily cron update'
git push
git status

echo finished at `date`
